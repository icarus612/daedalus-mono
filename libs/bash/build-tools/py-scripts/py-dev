#!/bin/bash

# Python dev script for monorepo packages
# Runs appropriate dev command without blocking

set -e

# Check if venv exists
if [ ! -d ".venv" ]; then
    echo "Virtual environment not found. Creating venv..."
    python3 -m venv .venv
fi

# Activate venv
source .venv/bin/activate

# Determine what to run based on available files
if [ -f "main.py" ]; then
    # Check if it's a Flask app and assign different ports
    if grep -q "from flask import\|import flask" main.py 2>/dev/null; then
        # Determine port based on directory name
        DIR_NAME=$(basename $(pwd))
        case "$DIR_NAME" in
            "maze-runner")
                PORT=5001
                ;;
            "pokedex")
                PORT=5002
                ;;
            "weather-fortcast")
                PORT=5003
                ;;
            "market-bots")
                PORT=5004
                ;;
            *)
                PORT=5000
                ;;
        esac
        echo "Starting Flask app on port $PORT..."
        FLASK_APP=main.py FLASK_ENV=development python -m flask run --port=$PORT
    else
        echo "Running main.py..."
        python main.py
    fi
else
    # For libraries, just exit successfully after checking imports
    echo "Python library - no dev server needed"
    exit 0
fi